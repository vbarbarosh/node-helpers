<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>@vbarbarosh/node-helpers</title>
    <link href="https://unpkg.com/@vbarbarosh/smcss@1.2.0/dist/sm.css" rel="stylesheet">
    <link href="css/default.css" rel="stylesheet">
</head>
<body>

<script src="https://unpkg.com/axios@1.11.0/dist/axios.min.js"></script>
<script src="https://unpkg.com/@vbarbarosh/ui-helpers@0.3.2/src/static/js/bundle.js"></script>
<script src="https://unpkg.com/@vbarbarosh/node-helpers@3.66.1/dist/browser.js"></script>
<script>
vue_component('main-header', {
    template: `
        <div>
            <p>A set of helpers for JavaScript/Node.js</p>

            <p align="center">
            <a href="https://github.com/vbarbarosh/node-helpers/actions"><img src="https://github.com/vbarbarosh/node-helpers/actions/workflows/node.js.yml/badge.svg" alt="@vbarbarosh/node-helpers CI status" /></a>
            <a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://img.shields.io/github/license/vbarbarosh/node-helpers" alt="License" /></a>
            <a href="https://www.npmjs.com/package/@vbarbarosh/node-helpers" rel="nofollow"><img src="https://img.shields.io/npm/dw/@vbarbarosh/node-helpers.svg" alt="npm" /></a>
            <a href="https://github.com/vbarbarosh/node-helpers" rel="nofollow"><img src="https://img.shields.io/github/stars/vbarbarosh/node-helpers" alt="stars" /></a>
            </p>

            <p align="center">
            <img src="img/node-helpers-by-chat-gpt.webp" style="max-height:400px;" />
            </p>

            <div>
                <div class="rel"><copy-to-clipboard value="npm install @vbarbarosh/node-helpers" /></div>
                <prism-bash value="npm install @vbarbarosh/node-helpers" />
            </div>
        </div>
    `,
});
vue_component('main-demos', {
    props: ['items', 'items_hit'],
    template: `
        <section v-for="item in items" v-bind:key="item.file" v-show="items_hit.has(item)">
            <h2 :id="item.id">{{ item.file }}</h2>
            <div>
                <div class="rel"><copy-to-clipboard :value="item.contents" /></div>
                <markdown v-if="item.file.endsWith('.md')" :value="item.contents" />
                <prism-js v-else-if="item.file.endsWith('.js')" :value="item.contents" />
                <prism-php v-else-if="item.file.endsWith('.php')" :value="item.contents" />
                <prism-bash v-else-if="item.file.endsWith('.sh')" :value="item.contents" />
                <prism-js v-else-if="item.contents.startsWith('#!/usr/bin/env node')" :value="item.contents"></prism-js>
                <pre v-else>{{ item.contents }}</pre>
            </div>
        </section>
    `,
});
vue_component('main-helpers', {
    props: ['items', 'items_hit'],
    template: `
        <section v-for="item in items" v-bind:key="item.file" v-show="items_hit.has(item)">
            <h2 :id="item.id">{{ item.name }}</h2>
            <tabs-underline>
                <tabs-item label="Description">
                    <div class="rel"><copy-to-clipboard :value="item.require" /></div>
                    <prism-js :value="item.require" />
                </tabs-item>
                <tabs-item label="Demos">
                    <lipsum />
                </tabs-item>
                <tabs-item label="Source">
                    <div class="rel"><copy-to-clipboard :value="item.source_code" /></div>
                    <prism-js :value="item.source_code" />
                </tabs-item>
            </tabs-underline>
        </section>
    `,
});
vue_component('app', {
    template: `
        <div v-if="ready" class="fix-f hsplit">
            <main class="fluid oa">
                <main-header />
                <main-helpers :items="items.src" :items_hit="items_hit" />
                <main-demos :items="items.demos" :items_hit="items_hit" />
                <div style="height:50vh;" />
            </main>
            <aside class="vsplit w300">
                <input-search ref="search" v-model="search" />
                <ul class="fluid oa">
                    <li v-for="item in items_all" v-bind:key="item.file" v-show="items_hit.has(item)" v-on:click="click_item_search(item)">
                        {{ item.file }}
                    </li>
                </ul>
            </aside>
        </div>
`,
    data: function () {
        return {
            ready: false,
            search: '',
            items: null,
        };
    },
    computed: {
        items_all: function () {
            return [...this.items.src, ...this.items.demos];
        },
        items_hit: function () {
            const filter = filter1_from_spec(this.search);
            return new Set(this.items_all.filter(v => filter(v.file)));
        },
    },
    methods: {
        refresh: async function () {
            this.items = await http_get_json('data.json');
            this.items.demos.sort((a,b) => a.file.localeCompare(b.file));
        },
        click_item_search: function (item) {
           window.location.replace(`#${item.id}`);
        },
    },
    created: async function () {
        await blocking(this.refresh());
        this.ready = true;
        await this.$nextTick();
        if (window.location.hash) {
            window.location.replace(window.location.hash);
        }
    },
    mounted: function () {
        const _this = this;
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey || event.metaKey || event.altKey) {
                return;
            }
            if (event.key === 'Escape') {
                _this.$refs.search.$el.blur();
                if (_this.$refs.search.$el.value) {
                    _this.$refs.search.$el.value = '';
                    _this.$refs.search.$el.dispatchEvent(new Event('input', {bubbles: true}));
                }
                return;
            }
            if (document.activeElement.tagName === 'INPUT') {
                return;
            }
            if (document.activeElement === _this.$refs.search.$el) {
                return;
            }
            _this.$refs.search.$el.focus();
            _this.$refs.search.$el.select();
        });
    },
});
</script>

</body>
</html>
