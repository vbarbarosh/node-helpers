<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>@vbarbarosh/node-helpers</title>
    <link href="https://unpkg.com/@vbarbarosh/smcss@1.2.0/dist/sm.css" rel="stylesheet">
    <link href="css/default.css" rel="stylesheet">
</head>
<body>

<script src="https://unpkg.com/axios@1.11.0/dist/axios.min.js"></script>
<script src="https://unpkg.com/@vbarbarosh/ui-helpers@0.4.0/src/static/js/bundle.js"></script>
<script src="https://unpkg.com/@vbarbarosh/node-helpers@3.72.5/dist/browser.js?var=h"></script>
<script src="js/components/main-demos.js"></script>
<script src="js/components/main-header.js"></script>
<script src="js/components/main-helpers.js"></script>
<script>
vue_component('app', {
    template: `
        <div v-if="ready" class="fix-f hsplit">
            <main class="fluid oa">
                <main-header />
                <main-helpers :items="items.src" :items_hit="items_hit" />
                <main-demos :items="items.demos" :items_hit="items_hit" />
                <div style="height:50vh;" />
            </main>
            <aside class="vsplit w300">
                <input-search ref="search" v-model="search" />
                <ul class="fluid oa">
                    <li v-for="item in items_all" v-bind:key="item.file" v-show="items_hit.has(item)" v-on:click="click_item_search(item)">
                        {{ item.file.replace(/^src\\//, '') }}
                    </li>
                </ul>
            </aside>
        </div>
`,
    data: function () {
        return {
            ready: false,
            search: '',
            items: null,
        };
    },
    computed: {
        // All available items
        items_all: function () {
            return [...this.items.src, ...this.items.demos];
        },
        // Items hit by filter
        items_hit: function () {
            const filter = h.filter1_from_spec(this.search);
            return new Set(this.items_all.filter(v => filter(v.file)));
        },
    },
    methods: {
        refresh: async function () {
            this.items = await http_get_json('data.json');
            this.items.demos.sort((a,b) => a.file.localeCompare(b.file));
        },
        click_item_search: function (item) {
           window.location.replace(`#${item.id}`);
        },
    },
    created: async function () {
        await blocking(this.refresh());
        this.ready = true;
        await this.$nextTick();
        if (window.location.hash) {
            window.location.replace(window.location.hash);
        }
    },
    mounted: function () {
        const _this = this;
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey || event.metaKey || event.altKey) {
                return;
            }
            if (event.key === 'Escape') {
                _this.$refs.search.$el.blur();
                if (_this.$refs.search.$el.value) {
                    _this.$refs.search.$el.value = '';
                    _this.$refs.search.$el.dispatchEvent(new Event('input', {bubbles: true}));
                }
                return;
            }
            if (document.activeElement.tagName === 'INPUT') {
                return;
            }
            if (document.activeElement === _this.$refs.search.$el) {
                return;
            }
            _this.$refs.search.$el.focus();
            _this.$refs.search.$el.select();
        });
    },
});
</script>

</body>
</html>
